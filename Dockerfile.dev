# Next.js Development Dockerfile with hot reload
FROM node:20-slim

# Install dependencies for building native modules
RUN apt-get update && apt-get install -y --no-install-recommends \
    python3 \
    make \
    g++ \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /app

# Copy package files
COPY package.json package-lock.json ./

# Install dependencies
RUN npm ci

# Copy config files needed for dev server
COPY tsconfig.json next.config.ts postcss.config.mjs ./

# Create directories and set ownership to node user (UID 1000 in node:20-slim)
RUN mkdir -p /app/data/uploads/lessons /app/.next && \
    chown -R node:node /app

USER node

EXPOSE 3000

CMD ["npm", "run", "dev"]
